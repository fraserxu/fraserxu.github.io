<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>AngularJS表单验证</title>
  <meta name="author" content="Fraser Xu" />
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/prettify.css" type="text/css" media="screen, projection" />
  <script type="text/javascript" src="/js/prettify.js"></script>
  <script type="text/javascript" src="/js/prettify-lua.js"></script>
</head>
<body onload="prettyPrint()">

  <div class="container">

    <div class="header">
      <h1><a href="/">Fraser Xu's</a></h1>
      <h2>Thoughts on life and code</h2>
    </div>

    <div class="nav">
      <a href="/">Cover</a>
      <a href="/archive.html">Archive</a>
      <a href="/about.html">About</a>
      <a href="/atom.xml">Subscribe</a>
    </div>

    <div class="content">
	<h1>AngularJS表单验证</h1>
	<p class="meta">12 Sep 2013</p>
	<p>近期项目需求，很多地方需要进行表单验证。对比传统使用jQuery方法来验证，AngularJS的数据绑定的优势瞬间体现出来。</p>

<p>在AngularJS中已经有很多可供利用的表单验证directive.我们首先来看一看最常用的一些，然后开始尝试写一些自定义的验证方法。</p>

<pre><code>&lt;form name="form"&gt;
  &lt;label name="email"&gt;Your email&lt;/label&gt;
  &lt;input type="email" name="email" ng-model="email" placeholder="Email Address" /&gt;
&lt;/form&gt;
</code></pre>

<p>我们可以不费太多力气的使用AngulaJS完成客户端表单验证。现实开发中我们不能完全依靠客户端表单验证来保障web应用的安全，但是这样做的好处是可以提供表单状态的即时反馈。</p>

<p>为了使用表单验证，我们首先必须保证form元素拥有关联的 <code>name</code> 属性。</p>

<p>所有的表单项都可以做一些简单的验证，例如最小长度，最大长度等等。这些都可以通过原生的HTML5属性来实现。</p>

<p>在实际开发中建议始终添加 <code>novalidate</code> 标记到form标签上，这样可以保证在表单不合法的情况下阻止浏览器继续提交数据。</p>

<p>下面我们来看一下我们可以在 <code>input</code> 表单域上添加的验证选项：</p>

<h3>Required 必填项</h3>

<p>为了验证某个表单项是否为空，只需要在表单域上添加一个HTML5标签: <code>required</code></p>

<pre><code>&lt;input type="text" required /&gt;
</code></pre>

<h3>Minimum length 最小长度</h3>

<p>为了验证某个表单项的数据至少有 {number} 个字符，只需要在表单域上加入 <code>ng-minlength="{number}"</code> directive:</p>

<pre><code>&lt;input type="text" ng-minlength=5 /&gt;
</code></pre>

<h3>Maximum length 最大长度</h3>

<p>为了验证某个表单项等于或者少于一定数目字符串，添加 <code>ng-maxlength="{number}"</code> directive:</p>

<pre><code>&lt;input type="text" ng-maxlength=20 /&gt;
</code></pre>

<h3>Matches a pattern 正则匹配</h3>

<p>为了确保某个表单匹配某个正则表达式，使用如下AngularJS directive: <code>ng-pattern="/PATTERN/"</code> :</p>

<pre><code>&lt;input type="text" ng-pattern="/a-zA-Z/" /&gt;
</code></pre>

<h3>Email地址</h3>

<p>为了验证表单项为email地址，只需设置 <code>input</code> 的type为 <code>email</code> 即可，例如：</p>

<pre><code>&lt;input type="email" name="email" ng-model="user.email" /&gt;
</code></pre>

<h3>Number 数字</h3>

<p>为了验证某个表单项为数字，设置 <code>input</code> 的type为 <code>number</code> :</p>

<pre><code>&lt;input type="number" name="age" ng-model="user.age" /&gt;
</code></pre>

<h3>Url地址</h3>

<p>为了验证表单内容为合法url地址，设置 <code>input</code> type 为 <code>url</code>:</p>

<pre><code>&lt;input type="url" name="homepage" ng-model="user.weibo_url" /&gt;
</code></pre>

<h3>自定义验证</h3>

<p>AngularJS同样也允许我们使用directive来添加自定义的验证方法。例如，我们需要验证username表单项的数据在数据库的唯一性。为了达成这个目的，我们需要完成一个directibe用于在表单数据发生变化时发起一次ajax请求。</p>

<pre><code>var app = angular.module('validationExample', []);

app.directive('ensureUnique', ['$http', function($http) {
    return {
        require: 'ngModel',
        link: function(scope, ele, attrs, c) {
            scope.$watch(attrs.ngModel, function() {
                $http({
                    method: 'POST',
                    url: '/api/check/' + attrs.ensureUnique,
                    data: {'field': attrs.ensureUnique}
                }).success(function(data, status, headers, cfg) {
                    c.$setValidity('unique', data.isUnique);
                }).error(function(data, status, headers, cfg) {
                    c.$setValidity('unique', false);
                });
            });
        }
    }
}]);
</code></pre>

<h2>控制表单变量</h2>

<p>AngularJS通过DOM元素上设置一个表单，从而使我们可以很容易的获取到当前 <code>$scope</code> 对象的属性。这样可以使我们即时的得到表单的最新数据。这里可供我们利用的属性如下：</p>

<p>注意这些属性是通过如下格式获取的：</p>

<pre><code>formName.inputFieldName.property
</code></pre>

<h3>Unmodified form 未改变表单</h3>

<p>返回一个布尔值，告诉我们用户是否修改了表单。</p>

<pre><code>formName.inputFieldName.$pristine
</code></pre>

<h3>Modified form 修改过的表单</h3>

<p>当且仅当用户实际修改过表单数据时返回一个布尔值。这个属性无视表单是否合法：</p>

<pre><code>formName.inputFieldName.$dirty
</code></pre>

<h3>Valid form 合法表单</h3>

<p>返回表单是否合法的布尔值。如果表单当前合法，则返回true:</p>

<pre><code>formName.inputFieldName.$valid
</code></pre>

<h3>Invalid form 非法表单</h3>

<p>返回表单是否合法的布尔值。如果表单不合法，则返回true:</p>

<pre><code>formName.inputFieldName.$invalid
</code></pre>

<p>最后两个属性在控制DOM元素隐藏或显示时特别有用。同时为某个特定表单设置class时也很方便。</p>

<h3>Errors 错误</h3>

<p>另外一个非常有用的属性是 <code>$error</code> 对象。这个对象包含了某个特定表单所有的验证信息以及表单是否合法。可以通过如下语法获取到这些属性：</p>

<pre><code>formName.inputFieldName.$error
</code></pre>

<p>如果某个验证失败，则这个属性返回true,相反如果这个属性为false,则代表验证通过。</p>

<h2>添加样式</h2>

<p>AngularJS在处理表单时会自动为当前状态添加某些特定类名称。这些class属性和我们检查属性时的名称也很类似。</p>

<p>包括如下class:</p>

<pre><code>.ng-pristine {}
.ng-dirty {}
.ng-valid {}
.ng-invalid {}
</code></pre>

<p>以上属性分别对应所检查表单项检查结果。</p>

<p>如果某个表单域非法，<code>ng-invalid</code>就会添加到对应的元素上。可以为元素添加如下样式：</p>

<pre><code>input.ng-invalid {border: 1px solid red;}
input.ng-valid {border: 1px solid green;}
</code></pre>

<blockquote><p>未完待续..</p></blockquote>

</div>

<div class="related">
  <h2>~ Related ~</h2>
  <ul class="posts">
    
      <li><span>12 Sep 2013</span> · <a href="/posts/Using-Handlebarsjs-with-Expressjs">在Express项目中使用Handlebars模板引擎</a></li>
    
      <li><span>22 Jun 2013</span> · <a href="/posts/Nginx-for-developers">写给Web开发人员看的Nginx介绍</a></li>
    
      <li><span>07 Jun 2013</span> · <a href="/posts/understanding-expressjs">(譯)深入理解Express.js</a></li>
    
      <li><span>07 Jun 2013</span> · <a href="/posts/thoughts-of-these-days">Life Sucks</a></li>
    
      <li><span>02 Jun 2013</span> · <a href="/posts/change-jekyll-blog-layout-in-ten-minutes">教你10分鐘內替換Jekyll博客樣式</a></li>
    
  </ul>
</div>

  </div>
</body>
</html>
